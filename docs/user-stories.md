# 查询微服务用户故事

| ID | 角色 | 用户故事 | 验收标准 |
| --- | --- | --- | --- |
| US-01 | 对接系统开发者 | 作为系统开发者，我希望通过公开 REST 接口按单号查询物流状态，以便在业务系统中直接展示结果。 | 访问 `GET /api/trackings/{trackingNo}` 返回标准 JSON，包含状态、承运商、更新时间；异常返回明确错误码。 |
| US-02 | 对接系统开发者 | 我希望在一次请求中查询多条单号，减少网络开销。 | `POST /api/trackings/query` 支持 <=50 条单号，返回数组；超额给出提示，不影响已处理单号。 |
| US-03 | 运营平台 | 我希望通过接口上传需要跟踪的单号（含来源信息），让服务自动开始刷新。 | `POST /api/trackings` 支持单条/批量，返回任务 ID；数据立即写入待刷新队列并可在日志中查询。 |
| US-04 | 外部推送服务 | 我希望微服务提供 webhook 接口接收 17-track 推送的单号或状态，避免重复开发。 | `POST /api/webhooks/17track` 支持签名校验，合法请求写队列并返回 200；非法请求返回 4xx。 |
| US-05 | 下游系统 | 我希望在状态更新后收到通知或能够主动拉取最新状态，以便触发自动流程。 | 状态刷新后写入 MySQL + Redis，并通过事件/消息（如 Redis Stream）推送变更摘要，或提供 `GET /api/trackings/{trackingNo}` 立即可查到新值。 |
| US-06 | 平台运维 | 我希望能够配置刷新频率和重试策略，并查看服务健康状况。 | 通过配置文件或环境变量调整刷新间隔、重试次数；`/actuator/health` 和 `/metrics` 提供状态；变更后任务按新配置执行。 |
# 查单后台用户故事

| ID | 角色 | 用户故事 | 验收标准 |
| --- | --- | --- | --- |
| US-01 | 客服 | 作为客服，我希望使用公司账号登录系统，以便安全访问查单后台。 | 能成功登录/登出；无权限用户被拒绝；失败有提示。 |
| US-02 | 客服 | 作为客服，我想输入单号立即得到物流状态，以便快速回复客户。 | 输入合法单号后 2 秒内返回状态，显示承运商/更新时间。 |
| US-03 | 客服 | 作为客服，我想批量上传单号并一次性查询结果，以节省时间。 | 支持上传含 <=100 条记录的 CSV/Excel；成功后返回汇总表。 |
| US-04 | 客服 | 作为客服，我想在单号详情页查看完整轨迹与备注，以便了解历史处理。 | 详情页展示时间线、当前状态、备注列表；数据与 MySQL 中一致。 |
| US-05 | 客服 | 作为客服，我希望给异常单添加备注并标记状态，以便交接给同事。 | 备注保存到数据库，状态同步更新；页面显示责任人和更新时间。 |
| US-06 | 客服 | 作为客服，我希望一键刷新单号状态，以获得更实时的数据。 | 点击刷新后异步任务触发，刷新完成显示最新时间；有失败提示。 |
| US-07 | 运营 | 作为运营主管，我想查看异常单列表并筛选责任人和状态，以掌握处理进度。 | 列表支持过滤与排序，导出 CSV；仅管理员可修改策略。 |
| US-08 | 运营 | 作为运营主管，我希望配置单号自动刷新策略，以确保重点订单及时同步。 | 能设置频率、重试次数；Redis/任务调度按配置生效。 |
| US-09 | 运营 | 作为运营主管，我希望查看关键操作日志，了解谁做了哪些操作。 | 提供时间、用户、操作类型的日志列表，可按日期筛选。 |

